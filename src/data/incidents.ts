// Incident definitions (50+ incidents)

import { IncidentDefinition } from '../sim/types';

export const INCIDENTS: IncidentDefinition[] = [
  // === TRAFFIC ===
  {
    id: 'viral_spike_small',
    name: 'Viral Content Spike',
    description: 'Viral post causing +50% traffic',
    category: 'TRAFFIC',
    severity: 'WARN',
    targetTypes: ['CDN', 'WAF', 'APP'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      utilizationMultiplier: 1.5,
      latencyMultiplier: 1.2,
    },
    resolutionOptions: ['scale_app_2', 'scale_app_5', 'enable_rate_limit_waf'],
    autoResolveSeconds: 300,
  },
  {
    id: 'viral_spike_large',
    name: 'Massive Viral Spike',
    description: 'Viral event causing +200% traffic',
    category: 'TRAFFIC',
    severity: 'CRIT',
    targetTypes: ['CDN', 'WAF', 'GLB', 'APP'],
    preconditions: {
      minUtilization: 0.6,
    },
    baseRatePerMinute: 0.02,
    effects: {
      utilizationMultiplier: 3.0,
      latencyMultiplier: 2.5,
      errorMultiplier: 1.5,
    },
    timeToOutageSeconds: 120,
    resolutionOptions: ['scale_app_5', 'enable_autoscaling', 'enable_rate_limit_waf'],
    autoResolveSeconds: 600,
  },
  {
    id: 'bot_surge',
    name: 'Bot Traffic Surge',
    description: 'Malicious bot swarm detected',
    category: 'TRAFFIC',
    severity: 'WARN',
    targetTypes: ['WAF', 'APIGW'],
    preconditions: {
      featureDisabled: 'botProtection',
    },
    baseRatePerMinute: 0.03,
    effects: {
      utilizationMultiplier: 1.8,
      errorMultiplier: 1.2,
    },
    resolutionOptions: ['enable_bot_protection', 'enable_rate_limit_waf'],
    autoResolveSeconds: 180,
  },
  {
    id: 'scraper_attack',
    name: 'Aggressive Scraper',
    description: 'Scraper hammering API',
    category: 'TRAFFIC',
    severity: 'INFO',
    targetTypes: ['APIGW', 'APP'],
    preconditions: {},
    baseRatePerMinute: 0.03,
    effects: {
      utilizationMultiplier: 1.3,
    },
    resolutionOptions: ['enable_rate_limit_apigw', 'enable_bot_protection'],
    autoResolveSeconds: 120,
  },

  // === SECURITY ===
  {
    id: 'ddos_l7',
    name: 'DDoS Attack (L7)',
    description: 'Application-layer DDoS attack',
    category: 'SECURITY',
    severity: 'CRIT',
    targetTypes: ['WAF', 'APIGW', 'APP'],
    preconditions: {},
    baseRatePerMinute: 0.03,
    effects: {
      utilizationMultiplier: 4.0,
      latencyMultiplier: 3.0,
      errorMultiplier: 2.0,
    },
    timeToOutageSeconds: 90,
    resolutionOptions: ['enable_bot_protection', 'enable_rate_limit_waf', 'scale_app_5'],
    autoResolveSeconds: 300,
  },
  {
    id: 'credential_leak',
    name: 'Credential Leak Detected',
    description: 'API keys found in public repo',
    category: 'SECURITY',
    severity: 'CRIT',
    targetTypes: ['APP'],
    preconditions: {},
    baseRatePerMinute: 0.01,
    effects: {
      errorMultiplier: 1.5,
    },
    resolutionOptions: ['rotate_secrets', 'enable_secrets_manager'],
  },
  {
    id: 'waf_bypass_attempt',
    name: 'WAF Bypass Attempt',
    description: 'Attacker probing WAF rules',
    category: 'SECURITY',
    severity: 'WARN',
    targetTypes: ['WAF'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      utilizationMultiplier: 1.2,
    },
    resolutionOptions: ['enable_bot_protection', 'security_audit'],
    autoResolveSeconds: 240,
  },
  {
    id: 'sql_injection_attempt',
    name: 'SQL Injection Attempt',
    description: 'Malicious SQL in requests',
    category: 'SECURITY',
    severity: 'WARN',
    targetTypes: ['APIGW', 'APP'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      errorMultiplier: 1.1,
    },
    resolutionOptions: ['enable_rate_limit_apigw', 'patch_dependency', 'security_audit'],
    autoResolveSeconds: 180,
  },
  {
    id: 'vulnerability_disclosure',
    name: 'Zero-Day Vulnerability',
    description: 'Critical CVE published',
    category: 'SECURITY',
    severity: 'CRIT',
    targetTypes: ['APP'],
    preconditions: {
      minTechDebt: 30,
    },
    baseRatePerMinute: 0.02,
    effects: {
      healthDecayPerSec: 0.01,
    },
    resolutionOptions: ['patch_dependency', 'security_audit'],
  },

  // === DEPLOY/CONFIG ===
  {
    id: 'bad_deploy',
    name: 'Bad Deployment',
    description: 'Recent deploy introduced bugs',
    category: 'DEPLOY',
    severity: 'CRIT',
    targetTypes: ['APP'],
    preconditions: {},
    baseRatePerMinute: 0.04,
    effects: {
      errorMultiplier: 3.0,
      latencyMultiplier: 1.5,
    },
    timeToOutageSeconds: 180,
    escalatesTo: 'complete_outage',
    escalationTimeSeconds: 120,
    resolutionOptions: ['rollback_deploy', 'emergency_restart', 'scale_app_5'],
  },
  {
    id: 'config_drift',
    name: 'Configuration Drift',
    description: 'Config out of sync across instances',
    category: 'DEPLOY',
    severity: 'WARN',
    targetTypes: ['APP', 'WORKERS'],
    preconditions: {
      minTechDebt: 40,
    },
    baseRatePerMinute: 0.02,
    effects: {
      errorMultiplier: 1.4,
      latencyMultiplier: 1.2,
    },
    resolutionOptions: ['rollback_deploy', 'scale_app_1'],
    autoResolveSeconds: 300,
  },
  {
    id: 'rate_limit_misconfigured',
    name: 'Rate Limit Blocking Users',
    description: 'Rate limit too aggressive',
    category: 'DEPLOY',
    severity: 'WARN',
    targetTypes: ['WAF', 'APIGW'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      errorMultiplier: 1.3,
    },
    resolutionOptions: ['enable_rate_limit_apigw'],
    autoResolveSeconds: 180,
  },
  {
    id: 'canary_failure',
    name: 'Canary Deploy Failed',
    description: 'Canary showing high errors',
    category: 'DEPLOY',
    severity: 'WARN',
    targetTypes: ['APP'],
    preconditions: {},
    baseRatePerMinute: 0.03,
    effects: {
      errorMultiplier: 1.5,
    },
    resolutionOptions: ['rollback_deploy'],
    autoResolveSeconds: 120,
  },

  // === DNS/CERT ===
  {
    id: 'dns_misconfigured',
    name: 'DNS Misconfiguration',
    description: 'DNS record pointing to wrong endpoint',
    category: 'DNS',
    severity: 'CRIT',
    targetTypes: ['DNS'],
    preconditions: {},
    baseRatePerMinute: 0.01,
    effects: {
      errorMultiplier: 5.0,
      healthDecayPerSec: 0.05, // Added health decay
    },
    timeToOutageSeconds: 60,
    resolutionOptions: ['emergency_restart', 'security_audit'],
    autoResolveSeconds: 240,
  },
  {
    id: 'tls_cert_expiring',
    name: 'TLS Cert Expiring Soon',
    description: 'Certificate expires in 7 days',
    category: 'DNS',
    severity: 'WARN',
    targetTypes: ['CDN', 'GLB'],
    preconditions: {},
    baseRatePerMinute: 0.005,
    effects: {},
    resolutionOptions: ['renew_tls_cert', 'security_audit'],
  },
  {
    id: 'tls_cert_expired',
    name: 'TLS Certificate Expired',
    description: 'Certificate expired, causing outage',
    category: 'DNS',
    severity: 'CRIT',
    targetTypes: ['CDN', 'GLB'],
    preconditions: {},
    baseRatePerMinute: 0.002,
    effects: {
      errorMultiplier: 10.0,
      healthDecayPerSec: 0.05,
    },
    timeToOutageSeconds: 30,
    resolutionOptions: ['renew_tls_cert', 'security_audit'],
  },
  {
    id: 'dns_propagation_delay',
    name: 'DNS Propagation Delay',
    description: 'DNS changes taking long to propagate',
    category: 'DNS',
    severity: 'INFO',
    targetTypes: ['DNS'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      latencyMultiplier: 1.5,
    },
    resolutionOptions: ['rollback_deploy'],
    autoResolveSeconds: 300,
  },

  // === COMPUTE/INFRA ===
  {
    id: 'memory_leak',
    name: 'Memory Leak',
    description: 'App instances leaking memory',
    category: 'COMPUTE',
    severity: 'WARN',
    targetTypes: ['APP', 'WORKERS'],
    preconditions: {
      minTechDebt: 20,
    },
    baseRatePerMinute: 0.03,
    effects: {
      utilizationMultiplier: 1.5,
      latencyMultiplier: 1.8,
      healthDecayPerSec: 0.005,
    },
    escalatesTo: 'oom_crash',
    escalationTimeSeconds: 300,
    resolutionOptions: ['scale_app_2', 'rollback_deploy'],
    autoResolveSeconds: 600,
  },
  {
    id: 'cpu_thrash',
    name: 'CPU Thrashing',
    description: 'High CPU causing degradation',
    category: 'COMPUTE',
    severity: 'WARN',
    targetTypes: ['APP', 'WORKERS'],
    preconditions: {
      minUtilization: 0.7,
    },
    baseRatePerMinute: 0.03,
    effects: {
      latencyMultiplier: 2.0,
      errorMultiplier: 1.3,
    },
    resolutionOptions: ['scale_app_2', 'scale_app_5', 'enable_autoscaling'],
    autoResolveSeconds: 180,
  },
  {
    id: 'disk_full',
    name: 'Disk Full',
    description: 'Instance disk at 100%',
    category: 'COMPUTE',
    severity: 'CRIT',
    targetTypes: ['APP', 'WORKERS', 'DB_PRIMARY'],
    preconditions: {
      minTechDebt: 30,
    },
    baseRatePerMinute: 0.03,
    effects: {
      errorMultiplier: 5.0,
      healthDecayPerSec: 0.02,
    },
    timeToOutageSeconds: 120,
    resolutionOptions: ['scale_app_1'],
    autoResolveSeconds: 240,
  },
  {
    id: 'node_reboot',
    name: 'Unexpected Node Reboot',
    description: 'Instance rebooted unexpectedly',
    category: 'COMPUTE',
    severity: 'WARN',
    targetTypes: ['APP', 'WORKERS'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      utilizationMultiplier: 1.3,
      errorMultiplier: 1.2,
    },
    resolutionOptions: ['scale_app_1'],
    autoResolveSeconds: 120,
  },
  {
    id: 'oom_crash',
    name: 'Out of Memory Crash',
    description: 'Instance OOMKilled',
    category: 'COMPUTE',
    severity: 'CRIT',
    targetTypes: ['APP', 'WORKERS'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      utilizationMultiplier: 2.0,
      errorMultiplier: 2.5,
      healthDecayPerSec: 0.01,
    },
    timeToOutageSeconds: 90,
    resolutionOptions: ['scale_app_2', 'scale_app_vertical'],
  },
  {
    id: 'network_saturation',
    name: 'Network Saturation',
    description: 'Network bandwidth maxed out',
    category: 'COMPUTE',
    severity: 'WARN',
    targetTypes: ['RLB', 'APP'],
    preconditions: {
      minUtilization: 0.8,
    },
    baseRatePerMinute: 0.02,
    effects: {
      latencyMultiplier: 2.5,
      errorMultiplier: 1.4,
    },
    resolutionOptions: ['scale_app_2', 'scale_rlb'],
    autoResolveSeconds: 240,
  },

  // === DATABASE ===
  {
    id: 'db_connection_exhaustion',
    name: 'DB Connection Exhaustion',
    description: 'Max connections reached',
    category: 'DATABASE',
    severity: 'CRIT',
    targetTypes: ['DB_PRIMARY'],
    preconditions: {
      minUtilization: 0.7,
      featureDisabled: 'connectionPool',
    },
    baseRatePerMinute: 0.03,
    effects: {
      errorMultiplier: 3.0,
      latencyMultiplier: 2.0,
    },
    timeToOutageSeconds: 150,
    resolutionOptions: ['increase_db_connections', 'add_connection_pooler'],
  },
  {
    id: 'slow_queries',
    name: 'Slow Query Storm',
    description: 'Inefficient queries slowing DB',
    category: 'DATABASE',
    severity: 'WARN',
    targetTypes: ['DB_PRIMARY'],
    preconditions: {
      minTechDebt: 25,
    },
    baseRatePerMinute: 0.03,
    effects: {
      latencyMultiplier: 2.5,
      utilizationMultiplier: 1.4,
    },
    resolutionOptions: ['optimize_queries', 'add_connection_pooler', 'upgrade_db_replica'],
    autoResolveSeconds: 300,
  },
  {
    id: 'replica_lag',
    name: 'Replica Lag Spike',
    description: 'Read replica falling behind',
    category: 'DATABASE',
    severity: 'WARN',
    targetTypes: ['DB_REPLICA'],
    preconditions: {
      minUtilization: 0.6,
    },
    baseRatePerMinute: 0.02,
    effects: {
      errorMultiplier: 1.3,
      latencyMultiplier: 1.4,
    },
    resolutionOptions: ['upgrade_db_replica', 'optimize_queries'],
    autoResolveSeconds: 240,
  },
  {
    id: 'deadlock',
    name: 'Database Deadlock',
    description: 'Transactions deadlocking',
    category: 'DATABASE',
    severity: 'WARN',
    targetTypes: ['DB_PRIMARY'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      errorMultiplier: 1.5,
      latencyMultiplier: 1.6,
    },
    resolutionOptions: ['optimize_queries', 'add_connection_pooler'],
    autoResolveSeconds: 180,
  },
  {
    id: 'db_disk_full',
    name: 'Database Disk Full',
    description: 'DB storage at capacity',
    category: 'DATABASE',
    severity: 'CRIT',
    targetTypes: ['DB_PRIMARY'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      errorMultiplier: 10.0,
      healthDecayPerSec: 0.03,
    },
    timeToOutageSeconds: 60,
    resolutionOptions: ['scale_db_vertical'],
  },
  {
    id: 'db_backup_failure',
    name: 'DB Backup Failed',
    description: 'Automated backup failed',
    category: 'DATABASE',
    severity: 'INFO',
    targetTypes: ['DB_PRIMARY'],
    preconditions: {},
    baseRatePerMinute: 0.03,
    effects: {},
    resolutionOptions: ['optimize_queries'],
    autoResolveSeconds: 300,
  },

  // === QUEUE/WORKERS ===
  {
    id: 'queue_backlog',
    name: 'Queue Backlog Growing',
    description: 'Messages piling up in queue',
    category: 'QUEUE',
    severity: 'WARN',
    targetTypes: ['QUEUE'],
    preconditions: {
      minUtilization: 0.6,
    },
    baseRatePerMinute: 0.03,
    effects: {
      utilizationMultiplier: 1.6,
      latencyMultiplier: 1.5,
    },
    resolutionOptions: ['add_workers_2', 'add_workers_5', 'increase_queue_throughput'],
    autoResolveSeconds: 300,
  },
  {
    id: 'poison_message',
    name: 'Poison Message Loop',
    description: 'Bad message causing retry loop',
    category: 'QUEUE',
    severity: 'CRIT',
    targetTypes: ['QUEUE', 'WORKERS'],
    preconditions: {},
    baseRatePerMinute: 0.04,
    effects: {
      utilizationMultiplier: 3.0,
      errorMultiplier: 2.0,
    },
    resolutionOptions: ['pause_workers', 'rollback_deploy'],
  },
  {
    id: 'worker_crash_loop',
    name: 'Worker Crash Loop',
    description: 'Workers crashing repeatedly',
    category: 'QUEUE',
    severity: 'CRIT',
    targetTypes: ['WORKERS'],
    preconditions: {
      minTechDebt: 30,
    },
    baseRatePerMinute: 0.03,
    effects: {
      errorMultiplier: 4.0,
      healthDecayPerSec: 0.02,
    },
    timeToOutageSeconds: 180,
    resolutionOptions: ['rollback_deploy', 'pause_workers'],
  },
  {
    id: 'queue_dlq_full',
    name: 'Dead Letter Queue Full',
    description: 'DLQ at capacity',
    category: 'QUEUE',
    severity: 'WARN',
    targetTypes: ['QUEUE'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      errorMultiplier: 1.3,
    },
    resolutionOptions: ['increase_queue_throughput', 'pause_workers'],
    autoResolveSeconds: 240,
  },

  // === EXTERNAL ===
  {
    id: 'third_party_api_down',
    name: 'Third-Party API Down',
    description: 'External dependency unavailable',
    category: 'EXTERNAL',
    severity: 'CRIT',
    targetTypes: ['APP'],
    preconditions: {},
    baseRatePerMinute: 0.03,
    effects: {
      errorMultiplier: 2.0,
      latencyMultiplier: 1.5,
    },
    resolutionOptions: ['enable_circuit_breaker', 'enable_retries', 'rollback_deploy', 'scale_app_2'],
    autoResolveSeconds: 600,
  },
  {
    id: 'third_party_api_slow',
    name: 'Third-Party API Slow',
    description: 'External API responding slowly',
    category: 'EXTERNAL',
    severity: 'WARN',
    targetTypes: ['APP'],
    preconditions: {},
    baseRatePerMinute: 0.03,
    effects: {
      latencyMultiplier: 2.0,
    },
    resolutionOptions: ['enable_circuit_breaker', 'enable_retries', 'scale_app_1', 'scale_cache'],
    autoResolveSeconds: 300,
  },
  {
    id: 'cloud_region_brownout',
    name: 'Cloud Region Brownout',
    description: 'Cloud provider degraded performance',
    category: 'EXTERNAL',
    severity: 'WARN',
    targetTypes: ['APP', 'DB_PRIMARY', 'CACHE'],
    preconditions: {},
    baseRatePerMinute: 0.04,
    effects: {
      latencyMultiplier: 1.8,
      errorMultiplier: 1.2,
    },
    resolutionOptions: ['add_region_eu', 'scale_app_2', 'enable_circuit_breaker'],
    autoResolveSeconds: 900,
  },
  {
    id: 'cloud_region_outage',
    name: 'Cloud Region Outage',
    description: 'Entire cloud region down',
    category: 'EXTERNAL',
    severity: 'CRIT',
    targetTypes: ['GLB', 'RLB', 'APP', 'DB_PRIMARY'],
    preconditions: {},
    baseRatePerMinute: 0.005,
    effects: {
      errorMultiplier: 10.0,
      healthDecayPerSec: 0.1,
    },
    timeToOutageSeconds: 30,
    resolutionOptions: ['add_region_eu', 'failover_to_replica', 'rollback_deploy'],
  },
  {
    id: 'cdn_degradation',
    name: 'CDN Provider Degraded',
    description: 'CDN having issues',
    category: 'EXTERNAL',
    severity: 'WARN',
    targetTypes: ['CDN'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      latencyMultiplier: 1.5,
      errorMultiplier: 1.2,
    },
    resolutionOptions: ['purge_cdn_cache', 'increase_cdn_ttl', 'scale_down_cdn'],
    autoResolveSeconds: 300,
  },

  // === OBSERVABILITY ===
  {
    id: 'log_pipeline_down',
    name: 'Log Pipeline Down',
    description: 'Logs not being collected',
    category: 'OBSERVABILITY',
    severity: 'WARN',
    targetTypes: ['OBSERVABILITY'],
    preconditions: {},
    baseRatePerMinute: 0.04,
    effects: {},
    resolutionOptions: ['upgrade_observability_metrics'],
    autoResolveSeconds: 300,
  },
  {
    id: 'alert_fatigue_spike',
    name: 'Alert Fatigue Spike',
    description: 'Too many alerts, MTTR increasing',
    category: 'OBSERVABILITY',
    severity: 'INFO',
    targetTypes: ['OBSERVABILITY'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {},
    resolutionOptions: ['hire_sre'],
    autoResolveSeconds: 600,
  },
  {
    id: 'metrics_lag',
    name: 'Metrics Reporting Lag',
    description: 'Metrics delayed, visibility reduced',
    category: 'OBSERVABILITY',
    severity: 'WARN',
    targetTypes: ['OBSERVABILITY'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {},
    resolutionOptions: ['upgrade_observability_traces'],
    autoResolveSeconds: 240,
  },

  // === CACHE ===
  {
    id: 'cache_invalidation_storm',
    name: 'Cache Invalidation Storm',
    description: 'Mass cache invalidations',
    category: 'COMPUTE',
    severity: 'WARN',
    targetTypes: ['CACHE'],
    preconditions: {},
    baseRatePerMinute: 0.02,
    effects: {
      utilizationMultiplier: 2.0,
      latencyMultiplier: 1.5,
    },
    resolutionOptions: ['scale_cache', 'flush_cache'],
    autoResolveSeconds: 180,
  },
  {
    id: 'cache_connection_errors',
    name: 'Cache Connection Errors',
    description: 'Redis connection issues',
    category: 'COMPUTE',
    severity: 'CRIT',
    targetTypes: ['CACHE'],
    preconditions: {},
    baseRatePerMinute: 0.03,
    effects: {
      errorMultiplier: 2.0,
      latencyMultiplier: 1.8,
    },
    resolutionOptions: ['scale_cache', 'flush_cache'],
    autoResolveSeconds: 240,
  },

  // === MISCELLANEOUS ===
  {
    id: 'retry_storm',
    name: 'Retry Storm',
    description: 'Cascading retries amplifying load',
    category: 'COMPUTE',
    severity: 'CRIT',
    targetTypes: ['APP'],
    preconditions: {
      featureDisabled: 'circuitBreaker',
    },
    baseRatePerMinute: 0.04,
    effects: {
      utilizationMultiplier: 5.0,
      latencyMultiplier: 3.0,
      errorMultiplier: 2.0,
    },
    timeToOutageSeconds: 120,
    resolutionOptions: ['enable_circuit_breaker', 'scale_app_5'],
  },
  {
    id: 'complete_outage',
    name: 'Complete Service Outage',
    description: 'Total system failure - try emergency recovery actions',
    category: 'COMPUTE',
    severity: 'CRIT',
    targetTypes: ['APP'],
    preconditions: {},
    baseRatePerMinute: 0.01,
    effects: {
      errorMultiplier: 100.0,
      healthDecayPerSec: 0.1, // Reduced from 0.2
    },
    timeToOutageSeconds: 0,
    resolutionOptions: [
      'emergency_restart',
      'force_scale_app',
      'kill_all_connections',
      'scale_app_5',
      'failover_to_replica',
      'restart_database',
      'flush_cache',
    ],
  },
];

